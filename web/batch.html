<!DOCTYPE html>
<html>
  <head>
    <title>batchd web client</title>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- jQuery rest -->
    <script src="/js/jquery.rest.min.js"></script>

    <link rel='stylesheet' type='text/css' href='/css/style.css'/>

  </head>
  <body>
    <h1>batchd web client</h1>

    <div class="content">
      <label for="queuelist">Queue:</label>
      <select id="queuelist">
      </select>
      <label for='selectstatus'>Status:</label>
      <select id='selectstatus'>
        <option value='all' selected>All</option>
        <option value='new'>New</option>
        <option value='waiting'>Waiting</option>
        <option value='processing'>Processing</option>
        <option value='done'>Done</option>
        <option value='failed'>Failed</option>
        <option value='postponed'>Postponed</option>
      </select>
      <input type='button' onclick='getJobs()' value='List jobs'/>
      <table id='jobslist'>
        <thead><tr>
            <td>ID</td><td>#</td><td>Type</td><td>Status</td><td>Create time</td><td>Finish time</td>
        </tr></thead>
      </table>
    </div>

    <script>
    var client = new $.RestClient('/');
    
    client.add('queue');

    client.queue.read().done(function(data) {
      $.each(data, function(k,v) {
        $('#queuelist').append(
            $('<option>').val(v.name).text(v.name)
          );
      });
    });

function getJobs() {
  var qname = $('#queuelist').val();
  var status = $('#selectstatus').val();
  client.queue.read(qname, {'status': status}).done(function(data) {
    $('#jobslist>tr').remove();
    $.each(data, function(k,v) {
      $('#jobslist').append(
          $('<tr>').addClass(v.status).append('<td>' + v.id + '</td><td>'
                                 + v.seq + '</td><td>'
                                 + v.type + '</td><td>'
                                 + v.status + '</td><td>'
                                 + v.create_time + '</td><td>'
                                 + v.result_time + '</td>')
        );
    });
  });
};
      
    </script>
  </body>
</html>
